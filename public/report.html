<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Body Insight — DEXA Report</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=Syne:wght@800&display=swap" rel="stylesheet">
<style>
  @font-face { font-family: 'Monument Extended'; src: url('/fonts/PPMonumentExtended-Black.otf') format('opentype'); font-weight: 800; }

  :root {
    --pri: #0F0F0F;
    --brand: #007aff;
    --brand-light: rgba(0,122,255,0.08);
    --txt: #1A1A1A;
    --dim: #6B7280;
    --mute: #9CA3AF;
    --bg: #F6F6F8;
    --card: #FFFFFF;
    --border: #E5E7EB;
    --grn: #059669; --grn-bg: #d1fae5;
    --ylw: #b45309; --ylw-bg: #fef3c7;
    --red: #dc2626; --red-bg: #fee2e2;
    --macro-p: #007aff; --macro-c: #f59e0b; --macro-f: #9CA3AF;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: none;
    display: flex; flex-direction: column; align-items: center;
    padding: 0; gap: 0;
    font-size: 13px; color: var(--txt); line-height: 1.6;
  }

  /* ===== PAGE ===== */
  .page { width: 500px; min-height: 880px; background: var(--bg); box-shadow: 0 20px 80px rgba(0,0,0,0.25); display: flex; flex-direction: column; overflow: hidden; }
  @media print {
    body { background: none; padding: 0; gap: 0; }
    .page { box-shadow: none; page-break-after: always; }
  }

  /* ===== HEADER ===== */
  .hdr { background: var(--pri); padding: 14px 24px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
  .hdr-l { display: flex; align-items: center; gap: 8px; }
  .hdr-icon { width: 24px; height: 24px; background: var(--brand); border-radius: 6px; display: flex; align-items: center; justify-content: center; }
  .hdr-icon svg { width: 13px; height: 13px; }
  .hdr-logo { font-family: 'Syne', sans-serif; font-size: 0.95rem; font-weight: 800; color: white; letter-spacing: -0.03em; }
  .hdr-section { font-size: 0.6rem; color: rgba(255,255,255,0.35); text-align: right; }
  .hdr-section strong { color: rgba(255,255,255,0.65); }

  /* ===== FOOTER ===== */
  .ftr { background: var(--pri); padding: 10px 24px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
  .ftr-left { font-size: 0.6rem; color: rgba(255,255,255,0.7); }
  .ftr-left a { color: rgba(255,255,255,0.7); text-decoration: none; }
  .ftr-pg { font-size: 0.55rem; color: rgba(255,255,255,0.7); font-weight: 600; }

  /* ===== CONTENT ===== */
  .content { flex: 1; padding: 20px 24px; display: flex; flex-direction: column; gap: 12px; overflow: hidden; }

  /* ===== COVER ===== */
  .cover { flex: 1; background: var(--pri); display: flex; flex-direction: column; padding: 40px 32px 32px; color: white; }
  .cover-top { text-align: center; margin-bottom: auto; }
  .cover-logo { font-family: 'Syne', sans-serif; font-size: 1.3rem; font-weight: 800; margin-bottom: 4px; }
  .cover-sub { font-size: 0.6rem; color: rgba(255,255,255,0.6); letter-spacing: 0.15em; text-transform: uppercase; font-weight: 600; }
  .cover-middle { display: flex; flex-direction: column; align-items: center; margin-bottom: auto; text-align: center; }
  .cover-prepared { font-size: 0.5rem; color: rgba(255,255,255,0.55); text-transform: uppercase; letter-spacing: 0.15em; font-weight: 600; margin-bottom: 6px; }
  .cover-name { font-family: 'Monument Extended', sans-serif; font-size: 2.8rem; font-weight: 800; line-height: 1.1; letter-spacing: -0.03em; }
  .cover-stat { }
  .cover-label { font-size: 0.45rem; color: rgba(255,255,255,0.55); text-transform: uppercase; letter-spacing: 0.12em; font-weight: 600; margin-bottom: 1px; }
  .cover-val { font-size: 0.85rem; font-weight: 700; color: rgba(255,255,255,0.85); }
  .cover-scan-num { display: inline-block; font-size: 0.5rem; font-weight: 700; color: rgba(255,255,255,0.5); background: rgba(255,255,255,0.08); padding: 3px 10px; border-radius: 10px; text-transform: uppercase; letter-spacing: 0.06em; margin-top: 6px; }
  .cover-bottom { text-align: center; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.06); }
  .cover-date { font-size: 0.62rem; color: rgba(255,255,255,0.6); margin-bottom: 4px; }
  .cover-id { font-size: 0.5rem; color: rgba(255,255,255,0.15); font-weight: 600; letter-spacing: 0.06em; }
  .cover-ftr { background: rgba(255,255,255,0.03); padding: 12px 24px; text-align: center; font-size: 0.6rem; color: rgba(255,255,255,0.55); }
  .cover-ftr a { color: rgba(255,255,255,0.7); text-decoration: none; }

  /* ===== TYPOGRAPHY ===== */
  .section-title { font-size: 1rem; font-weight: 800; color: var(--txt); margin-bottom: 2px; }
  .section-desc { font-size: 0.7rem; color: var(--dim); line-height: 1.55; }
  .label { font-size: 0.55rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: var(--brand); }

  .num-hero { font-family: 'Monument Extended', sans-serif; font-size: 3rem; font-weight: 800; line-height: 1; color: var(--pri); letter-spacing: -0.03em; }
  .num-hero span { font-size: 1.2rem; color: var(--mute); }
  .num-lg { font-family: 'Monument Extended', sans-serif; font-size: 1.8rem; font-weight: 800; line-height: 1; color: var(--pri); }
  .num-md { font-family: 'Monument Extended', sans-serif; font-size: 1.2rem; font-weight: 800; line-height: 1; color: var(--pri); }
  .num-sm { font-family: 'Monument Extended', sans-serif; font-size: 0.9rem; font-weight: 800; line-height: 1; color: var(--pri); }

  /* ===== CARDS ===== */
  .card { background: var(--card); border-radius: 14px; padding: 16px 18px; }
  .card-title { font-size: 0.58rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; color: var(--brand); margin-bottom: 8px; }

  /* ===== TAGS ===== */
  .tag { display: inline-block; font-size: 0.58rem; font-weight: 700; padding: 3px 10px; border-radius: 12px; text-transform: uppercase; letter-spacing: 0.04em; }
  .tag-g { background: var(--grn-bg); color: var(--grn); }
  .tag-y { background: var(--ylw-bg); color: var(--ylw); }
  .tag-r { background: var(--red-bg); color: var(--red); }
  .tag-n { background: #f3f4f6; color: var(--dim); }

  /* ===== SCALE ===== */
  .scale { position: relative; padding-top: 22px; margin-bottom: 6px; }
  .scale-bar { height: 10px; border-radius: 5px; }
  .scale-marker { position: absolute; top: 0; transform: translateX(-50%); display: flex; flex-direction: column; align-items: center; }
  .scale-marker-label { font-size: 0.55rem; font-weight: 800; color: white; background: var(--brand); padding: 2px 7px; border-radius: 4px; margin-bottom: 2px; }
  .scale-marker-arrow { width: 0; height: 0; border-left: 4px solid transparent; border-right: 4px solid transparent; border-top: 5px solid var(--brand); }
  .scale-ticks { display: flex; justify-content: space-between; font-size: 0.5rem; color: var(--mute); font-weight: 600; }
  .scale-legend { display: grid; grid-template-columns: 1fr 1fr; gap: 3px 12px; margin-top: 6px; }
  .scale-legend-item { display: flex; align-items: center; gap: 6px; font-size: 0.6rem; color: var(--txt); font-weight: 500; }
  .scale-legend-dot { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }

  /* ===== RANGE BAR ===== */
  .range-bar { height: 5px; border-radius: 3px; position: relative; margin: 6px 0 4px; }
  .range-dot { position: absolute; top: -4px; width: 13px; height: 13px; background: white; border: 3px solid var(--pri); border-radius: 50%; transform: translateX(-50%); }

  /* ===== VERDICT ===== */
  .verdict { display: inline-flex; align-items: center; gap: 4px; font-size: 0.58rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.04em; }
  .verdict-dot { width: 6px; height: 6px; border-radius: 50%; }

  /* ===== ACTION BOX ===== */
  .action { background: var(--card); border-radius: 12px; padding: 14px 18px; border-left: 3px solid var(--border); font-size: 0.7rem; color: var(--dim); line-height: 1.6; }
  .action strong { color: var(--txt); }
  .action-g { border-left-color: var(--grn); }
  .action-y { border-left-color: #f59e0b; }
  .action-r { border-left-color: #ef4444; }
  .action-n { border-left-color: #9ca3af; }

  /* ===== IMAGE PLACEHOLDER ===== */
  .img-ph { border-radius: 12px; display: flex; align-items: center; justify-content: center; background: #f3f4f6; border: 1px dashed var(--border); flex-shrink: 0; }
  .img-ph::after { font-size: 0.45rem; color: var(--mute); font-weight: 700; text-transform: uppercase; letter-spacing: 0.08em; text-align: center; white-space: pre-line; }
  .img-ph-dexa::after { content: 'DEXA\AScan'; }
  .img-ph-body::after { content: 'Body\ARegions'; }

  /* ===== REGION CARD (for sectional + symmetry + bone) ===== */
  .region { background: var(--card); border-radius: 12px; padding: 10px; display: flex; gap: 10px; align-items: stretch; flex: 1; }
  .region + .region { margin-top: 4px; }
  .region-img { width: 75px; border-radius: 8px; overflow: hidden; flex-shrink: 0; }
  .region-data { flex: 1; min-width: 0; display: flex; flex-direction: column; justify-content: center; gap: 2px; }
  .region-name { font-size: 0.72rem; font-weight: 800; color: var(--txt); text-transform: uppercase; letter-spacing: 0.04em; margin-bottom: 2px; }
  .region-fat { font-family: 'Monument Extended', sans-serif; font-size: 1rem; font-weight: 800; color: var(--pri); line-height: 1; }
  .region-fat small { font-size: 0.5rem; color: var(--mute); font-family: 'DM Sans'; font-weight: 600; }
  .region-metrics { display: flex; gap: 12px; margin-top: 4px; }
  .region-met { }
  .region-met-label { font-size: 0.42rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em; color: var(--mute); }
  .region-met-val { font-size: 0.7rem; font-weight: 700; color: var(--txt); }

  /* ===== SYMMETRY REGION ===== */
  .sym-region { background: var(--card); border-radius: 12px; padding: 16px; display: flex; gap: 14px; }
  .sym-region + .sym-region { margin-top: 10px; }
  .sym-img { width: 120px; min-height: 120px; border-radius: 8px; overflow: hidden; flex-shrink: 0; }
  .sym-data { flex: 1; }
  .sym-name { font-size: 0.78rem; font-weight: 800; color: var(--txt); text-transform: uppercase; letter-spacing: 0.04em; margin-bottom: 8px; }
  .sym-table { width: 100%; border-collapse: collapse; }
  .sym-table th { font-size: 0.52rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em; color: var(--mute); text-align: center; padding: 6px 6px; }
  .sym-table th:first-child { text-align: left; }
  .sym-table td { font-size: 0.72rem; font-weight: 600; color: var(--txt); text-align: center; padding: 6px 6px; border-top: 1px solid #f5f5f5; }
  .sym-table td:first-child { text-align: left; color: var(--dim); font-size: 0.62rem; }
  .sym-verdict { font-size: 0.55rem; font-weight: 700; margin-top: 4px; }

  /* ===== BONE REGION GRID ===== */
  .bone-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
  .bone-card { background: var(--card); border-radius: 10px; padding: 8px; display: flex; flex-direction: column; align-items: center; text-align: center; }
  .bone-img { width: 60%; margin: 0 auto; border-radius: 6px; overflow: hidden; margin-bottom: 4px; }
  .bone-name { font-size: 0.52rem; font-weight: 700; color: var(--dim); text-transform: uppercase; letter-spacing: 0.06em; }
  .bone-val { font-family: 'Monument Extended', sans-serif; font-size: 0.85rem; font-weight: 800; color: var(--pri); margin: 2px 0; }
  .bone-unit { font-size: 0.42rem; color: var(--mute); }

  /* ===== VF / BONE HEALTH SCALES ===== */
  .vf-scale { height: 10px; border-radius: 5px; background: linear-gradient(90deg, #34d399 0%, #6ee7b7 25%, #fbbf24 50%, #fb923c 75%, #f87171 100%); position: relative; margin: 22px 0 6px; }
  .vf-dot { position: absolute; top: -5px; width: 20px; height: 20px; background: white; border: 3px solid var(--brand); border-radius: 50%; transform: translateX(-50%); }
  .vf-you { position: absolute; top: -20px; transform: translateX(-50%); font-size: 0.5rem; font-weight: 800; text-transform: uppercase; color: var(--brand); letter-spacing: 0.06em; }
  .bh-scale-bar { height: 10px; border-radius: 5px; background: linear-gradient(90deg, #f87171 0%, #fbbf24 35%, #34d399 65%, #34d399 100%); position: relative; margin: 22px 0 6px; }

  /* ===== DATA TABLE ===== */
  .dtable { width: 100%; border-collapse: collapse; }
  .dtable th { padding: 6px 8px; font-size: 0.5rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em; color: var(--mute); text-align: center; border-bottom: 2px solid var(--border); }
  .dtable th:first-child { text-align: left; }
  .dtable td { padding: 6px 8px; font-size: 0.7rem; font-weight: 600; color: var(--txt); text-align: center; border-bottom: 1px solid #f3f4f6; }
  .dtable td:first-child { text-align: left; font-weight: 700; }

  /* ===== STACK BAR ===== */
  .stack-bar { display: flex; height: 16px; border-radius: 5px; overflow: hidden; gap: 2px; }
  .stack-seg { display: flex; align-items: center; justify-content: center; font-size: 0.5rem; font-weight: 700; color: white; border-radius: 3px; }

  /* ===== TREND ===== */
  .trend-chart { background: var(--card); border-radius: 10px; padding: 10px; }
  .trend-labels { display: flex; justify-content: space-between; font-size: 0.48rem; color: var(--mute); margin-top: 3px; padding: 0 4px; }

  /* ===== DELTAS ===== */
  .pos { color: var(--grn); } .neg { color: var(--red); }

  /* ===== MACRO ===== */
  .macro-row { background: var(--card); border-radius: 12px; padding: 14px 16px; display: flex; justify-content: space-between; align-items: center; }
  .macro-row + .macro-row { margin-top: 0; }
  .macro-circles { display: flex; gap: 8px; }
  .macro-circ { display: flex; flex-direction: column; align-items: center; gap: 2px; }
  .macro-ring { width: 48px; height: 48px; border-radius: 50%; border: 3px solid var(--pri); display: flex; flex-direction: column; align-items: center; justify-content: center; padding-top: 4px; }
  .macro-ring-num { font-family: 'Monument Extended', sans-serif; font-size: 0.75rem; font-weight: 800; color: var(--pri); line-height: 1; }
  .macro-ring-unit { font-size: 0.38rem; color: var(--mute); }
  .macro-label { font-size: 0.45rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em; color: var(--dim); }

  /* ===== TREND INLINE ===== */
  .trend-row { display: flex; gap: 16px; font-size: 0.55rem; color: var(--dim); padding: 8px 0 0; }
  .trend-row span { font-weight: 700; }
  .region-delta { font-size: 0.5rem; color: var(--grn); font-weight: 700; margin-top: 1px; }

  /* ===== GRIDS ===== */
  .g2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
  .g3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }

  /* ===== INSIGHTS ===== */
  .insight { background: var(--card); border-radius: 12px; padding: 12px 14px; }
  .insight h4 { font-size: 0.68rem; font-weight: 700; color: var(--txt); margin-bottom: 3px; }
  .insight p, .insight ul { font-size: 0.58rem; color: var(--dim); line-height: 1.5; }
  .insight ul { margin: 0; padding-left: 14px; }

  /* ===== ACTION PLAN ===== */
  .ap-item { display: flex; gap: 12px; padding: 10px 0; border-bottom: 1px solid #f3f4f6; }
  .ap-item:last-child { border-bottom: none; }
  .ap-num { width: 22px; height: 22px; border-radius: 50%; background: var(--brand); color: white; font-size: 0.55rem; font-weight: 800; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px; }
  .ap-text h4 { font-size: 0.75rem; font-weight: 700; color: var(--txt); margin-bottom: 2px; }
  .ap-text p { font-size: 0.6rem; color: var(--dim); line-height: 1.5; }
</style>
</head>
<body>
<script>
// ── Fetch report data from API ───────────────────────────────────────────────
async function fetchReportData() {
  const res = await fetch('https://pbkivbwxx9.execute-api.ap-south-1.amazonaws.com/prod/getDexaDataForAppointment', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ appointmentId: '6966822dd5859bf0394d4f6f', botCode: 'PBGFVO' })
  });
  const json = await res.json();
  return json;
}

// ── Helpers ──────────────────────────────────────────────────────────────────
function formatDate(dateStr) {
  const d = new Date(dateStr + 'T00:00:00');
  const m = ['January','February','March','April','May','June','July','August','September','October','November','December'];
  return d.getDate() + ' ' + m[d.getMonth()] + ' ' + d.getFullYear();
}
function shortDate(dateStr) {
  const d = new Date(dateStr + 'T00:00:00');
  const m = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  return d.getDate() + ' ' + m[d.getMonth()] + ' ' + d.getFullYear();
}
const vc = c => ({green:'var(--grn)',yellow:'var(--ylw)',red:'var(--red)',grey:'var(--dim)'}[c]||'var(--dim)');
const vd = c => ({green:'#34d399',yellow:'#f59e0b',red:'#dc2626',grey:'#9CA3AF'}[c]||'#9CA3AF');
const tc = c => ({green:'tag-g',yellow:'tag-y',red:'tag-r',grey:'tag-n'}[c]||'tag-n');
const ac = c => ({green:'action-g',yellow:'action-y',red:'action-r',neutral:'action-n',grey:'action-n'}[c]||'action-g');
const BF_CATEGORIES = ['Low Body Fat Risk','Ultra Lean','Lean Body','Higher than average','Excess Body Fat','High Fat Risk'];
function bfScale(thresholds) {
  // thresholds: [0, 7, 14, 21, 29, 36, 43] — first is min, last is max, 5 zone boundaries in between
  const min = thresholds[0], max = thresholds[thresholds.length - 1];
  const zones = thresholds.slice(1, -1);
  const p = zones.map(v => (((v - min) / (max - min)) * 100).toFixed(1));
  const grad = `linear-gradient(90deg, #f87171 0%, #f87171 ${p[0]}%, #34d399 ${p[0]}%, #34d399 ${p[1]}%, #6ee7b7 ${p[1]}%, #6ee7b7 ${p[2]}%, #fbbf24 ${p[2]}%, #fbbf24 ${p[3]}%, #fb923c ${p[3]}%, #fb923c ${p[4]}%, #f87171 ${p[4]}%, #f87171 100%)`;
  return { grad, ticks: thresholds, min, max, zones };
}
function bfCategory(fatPercent, zones) {
  for (let i = 0; i < zones.length; i++) { if (fatPercent < zones[i]) return BF_CATEGORIES[i]; }
  return BF_CATEGORIES[BF_CATEGORIES.length - 1];
}
function compScale(item) {
  // If val or thresholds missing, return null — caller renders "N/A" state
  if (item.val == null || !item.thresholds) return null;
  const t = item.thresholds;
  const min = t[0], b1 = t[1], b2 = t[2], max = t[3];
  const rng = max - min;
  const pos = Math.min(Math.max((item.val - min) / rng * 100, 0), 100).toFixed(1);
  const p1 = ((b1 - min) / rng * 100).toFixed(1);
  const p2 = ((b2 - min) / rng * 100).toFixed(1);
  const pf = parseFloat(pos);
  let grad, verdictColor, verdict;
  if (item.scaleType === 'higher_better') {
    grad = `linear-gradient(90deg, #f87171 0%, #fbbf24 ${p1}%, #34d399 ${p2}%, #34d399 100%)`;
    verdictColor = pf < parseFloat(p1) ? 'red' : pf < parseFloat(p2) ? 'yellow' : 'green';
    verdict = pf < parseFloat(p1) ? 'Low' : pf < parseFloat(p2) ? 'Average' : 'Good';
  } else if (item.scaleType === 'lower_better') {
    grad = `linear-gradient(90deg, #34d399 0%, #34d399 ${p1}%, #fbbf24 ${p2}%, #f87171 100%)`;
    verdictColor = pf < parseFloat(p1) ? 'green' : pf < parseFloat(p2) ? 'yellow' : 'red';
    verdict = pf < parseFloat(p1) ? 'Healthy' : pf < parseFloat(p2) ? 'Average' : 'High';
  } else {
    grad = `linear-gradient(90deg, #f87171 0%, #fbbf24 ${p1}%, #34d399 ${p1}%, #34d399 ${p2}%, #fbbf24 ${p2}%, #f87171 100%)`;
    verdictColor = pf < parseFloat(p1) || pf > parseFloat(p2) ? 'red' : 'green';
    verdict = pf < parseFloat(p1) ? 'Low' : pf > parseFloat(p2) ? 'High' : 'Normal';
  }
  return { grad, pos, verdictColor, verdict };
}
const REGIONS = {
  arms:    { name: 'Arms',    image: 'arms' },
  legs:    { name: 'Legs',    image: 'legs' },
  trunk:   { name: 'Trunk',   image: 'trunk' },
  android: { name: 'Android', image: 'android' },
  gynoid:  { name: 'Gynoid',  image: 'gynoid' }
};
const REGION_ORDER = ['arms','legs','trunk','android','gynoid'];
const HDR = s => `<div class="hdr"><div class="hdr-l"><div class="hdr-icon"><svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 1 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z"/></svg></div><span class="hdr-logo">BODY INSIGHT</span></div><div class="hdr-section"><strong>${s}</strong></div></div>`;
const FTR = (p,t) => `<div class="ftr"><div class="ftr-left">&#127760; bodyinsight.in</div><div style="font-size:0.6rem; color:rgba(255,255,255,0.7); display:flex; align-items:center; gap:3px;"><svg viewBox="0 0 24 24" width="11" height="11" fill="rgba(255,255,255,0.7)"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/></svg> @bodyinsight.in</div><div class="ftr-pg">${p} of ${t}</div></div>`;

function trendSvg(points, W=240, H=70, suffix='', invert=false) {
  const vals = points.map(p=>p.value), mn = Math.min(...vals), mx = Math.max(...vals), rng = mx-mn||1;
  const pX=20, pY=6, cW=W-pX*2, cH=H-pY*2;
  const x = i => pX + (i/(points.length-1))*cW;
  const y = v => { const n=(v-mn)/rng; return invert ? pY+n*cH : pY+(1-n)*cH; };
  const pts = points.map((p,i) => x(i).toFixed(0)+','+y(p.value).toFixed(0)).join(' ');
  const circles = points.map((p,i) => `<circle cx="${x(i).toFixed(0)}" cy="${y(p.value).toFixed(0)}" r="3" fill="var(--pri)"/>`).join('');
  const labels = points.map((p,i) => {
    const last = i===points.length-1, cy=y(p.value), ly = cy>cH/2+pY ? cy-6 : cy+14;
    return `<text x="${x(i).toFixed(0)}" y="${ly}" font-size="7" fill="${last?'var(--grn)':'var(--dim)'}" text-anchor="middle" font-weight="${last?700:600}">${p.value}${suffix}</text>`;
  }).join('');
  return `<svg viewBox="0 0 ${W} ${H}" style="width:100%;flex:1;">
    <line x1="0" y1="${H-pY}" x2="${W}" y2="${H-pY}" stroke="#e5e7eb" stroke-width="0.5"/>
    <line x1="0" y1="${Math.round(H/2)}" x2="${W}" y2="${Math.round(H/2)}" stroke="#e5e7eb" stroke-width="0.5" stroke-dasharray="3"/>
    <line x1="0" y1="${pY}" x2="${W}" y2="${pY}" stroke="#e5e7eb" stroke-width="0.5"/>
    <polyline points="${pts}" fill="none" stroke="var(--pri)" stroke-width="2" stroke-linecap="round"/>
    ${circles}${labels}</svg>`;
}
function trendLabels(pts) { return `<div class="trend-labels">${pts.map(p=>`<span>${p.date||p.label}</span>`).join('')}</div>`; }
function trendTable(pts, hdr, suffix='') {
  const r = [...pts].reverse();
  return `<table class="dtable" style="width:auto;flex-shrink:0;margin:0;font-size:0.5rem;">
    <tr><th>Date</th><th>${hdr}</th></tr>
    ${r.map((p,i)=>`<tr><td>${p.date||p.label}</td><td>${i===0?'<strong>':''}${p.value}${suffix}${i===0?'</strong>':''}</td></tr>`).join('')}</table>`;
}
function trendCard(title, pts, hdr, suffix='', inv=false) {
  return `<div class="card" style="padding:12px 14px;flex:1;display:flex;flex-direction:column;">
    <div class="card-title">${title}</div>
    <div style="display:flex;gap:12px;align-items:stretch;flex:1;">
      <div class="trend-chart" style="flex:1;min-width:0;display:flex;flex-direction:column;">
        ${trendSvg(pts,240,70,suffix,inv)}${trendLabels(pts)}
      </div>${trendTable(pts,hdr,suffix)}</div></div>`;
}

// ── Render ───────────────────────────────────────────────────────────────────
function render(d) {
  const c = d.cover, g = d.atAGlance, bc = d.bodyComposition, ct = d.compositionTrends;
  const ra = d.regionalAnalysis, rt = d.regionalTrends, sym = d.symmetry;
  const vf = d.visceralFat, bh = d.boneHealth, ag = d.agRatio;
  const sa = d.sarcopenia, met = d.metabolism, nut = met, ap = d.actionPlan;
  const tp = c.totalPages;
  const bf = bfScale(g.bodyFatThresholds);

  document.body.innerHTML = `

<!-- PAGE 1: COVER -->
<div class="page" style="display:flex;flex-direction:column;padding:0;overflow:hidden;background:var(--pri);">
  <div class="cover">
    <div class="cover-top"><div class="cover-logo">BODY INSIGHT</div><div class="cover-sub">DEXA Body Composition Report</div></div>
    <div class="cover-middle">
      <div class="cover-prepared">Prepared for</div>
      <div class="cover-name">${c.name}</div>
      <div style="display:flex;gap:20px;margin-top:16px;">
        <div class="cover-stat"><div class="cover-label">Age / Sex</div><div class="cover-val">${c.age} / ${c.sex}</div></div>
        <div class="cover-stat"><div class="cover-label">Height</div><div class="cover-val">${c.heightCm} cm</div></div>
        <div class="cover-stat"><div class="cover-label">Weight</div><div class="cover-val">${c.weightKg} kg</div></div>
      </div>
    </div>
    <div class="cover-bottom"><div class="cover-date">${formatDate(c.scanDate)}</div></div>
  </div>
  <div class="cover-ftr"><a>bodyinsight.in</a> &middot; support@bodyinsight.in</div>
</div>

<!-- PAGE 2: AT A GLANCE -->
<div class="page">
  ${HDR('At a Glance')}
  <div class="content">
    <div><div class="section-title">Your Results at a Glance</div><div class="section-desc">Summary of your DEXA body composition scan from ${shortDate(c.scanDate)}.</div></div>
    <div class="card">
      <div style="display:flex;align-items:center;gap:16px;margin-bottom:12px;">
        <div class="num-hero">${g.bodyFatPercent.toFixed(1)}<span>%</span></div>
        <div><div class="tag ${tc(g.bodyFatPercent<bf.zones[1]?'green':g.bodyFatPercent<bf.zones[3]?'yellow':'red')}">${bfCategory(g.bodyFatPercent, bf.zones)}</div></div>
      </div>
      <div class="card-title">Body Fat Scale</div>
      <div class="scale"><div class="scale-marker" style="left:${Math.min(Math.max((g.bodyFatPercent-bf.min)/(bf.max-bf.min)*100,0),100).toFixed(1)}%;"><span class="scale-marker-label">You</span><span class="scale-marker-arrow"></span></div><div class="scale-bar" style="background:${bf.grad};"></div></div>
      <div class="scale-ticks">${bf.ticks.map(t=>'<span>'+t+'%</span>').join('')}</div>
      <div class="scale-legend">
        <div class="scale-legend-item"><span class="scale-legend-dot" style="background:#f87171;"></span>Low fat risk</div>
        <div class="scale-legend-item"><span class="scale-legend-dot" style="background:#34d399;"></span>Ultra lean</div>
        <div class="scale-legend-item"><span class="scale-legend-dot" style="background:#6ee7b7;"></span>Lean</div>
        <div class="scale-legend-item"><span class="scale-legend-dot" style="background:#fbbf24;"></span>Moderate</div>
        <div class="scale-legend-item"><span class="scale-legend-dot" style="background:#fb923c;"></span>Excess fat</div>
        <div class="scale-legend-item"><span class="scale-legend-dot" style="background:#f87171;"></span>High fat risk</div>
      </div>
    </div>
    <div class="g2">
      <div class="card" style="text-align:center;"><div class="label">Total Mass</div><div class="num-lg" style="margin:6px 0 2px;">${g.totalMassKg}</div><div style="font-size:0.55rem;color:var(--mute);">kg</div></div>
      <div class="card" style="text-align:center;"><div class="label">Lean Mass</div><div class="num-lg" style="margin:6px 0 2px;">${g.leanMassKg}</div><div style="font-size:0.55rem;color:var(--mute);">kg &middot; ${g.leanMassPercent}%</div></div>
      <div class="card" style="text-align:center;"><div class="label">Fat Mass</div><div class="num-lg" style="margin:6px 0 2px;">${g.fatMassKg}</div><div style="font-size:0.55rem;color:var(--mute);">kg &middot; ${g.fatMassPercent}%</div></div>
      <div class="card" style="text-align:center;"><div class="label">Bone Mineral</div><div class="num-lg" style="margin:6px 0 2px;">${g.boneMineralKg}</div><div style="font-size:0.55rem;color:var(--mute);">kg &middot; ${g.boneMineralPercent}%</div></div>
    </div>
    <div class="g2">
      <div class="card" style="text-align:center;${vf?'':' opacity:0.4;'}"><div class="label">Visceral Fat</div><div class="num-lg" style="margin:6px 0 2px;">${vf?vf.massGrams:'N/A'}</div><div style="font-size:0.55rem;color:var(--mute);">${vf?'grams':'Not measured'}</div></div>
      <div class="card" style="text-align:center;${bh.tScore!=null?'':' opacity:0.4;'}"><div class="label">T-Score (Bone Health)</div><div class="num-lg" style="margin:6px 0 2px;">${bh.tScore!=null?bh.tScore:'N/A'}</div><div style="font-size:0.55rem;color:var(--mute);">${bh.tScore!=null?'vs healthy 30-yr-old':'Not available'}</div></div>
    </div>
    <div class="g2">
      <div class="card" style="text-align:center;"><div class="label">Resting Metabolic Rate</div><div class="num-lg" style="margin:6px 0 2px;">${met.rmr}</div><div style="font-size:0.55rem;color:var(--mute);">kcal/day at rest</div></div>
      <div class="card" style="text-align:center;"><div class="label">Total Daily Expenditure</div><div class="num-lg" style="margin:6px 0 2px;">${Math.round(met.tdee)}</div><div style="font-size:0.55rem;color:var(--mute);">kcal/day</div></div>
    </div>
  </div>
  ${FTR(2,tp)}
</div>

<!-- PAGE 3: BODY COMPOSITION -->
<div class="page">
  ${HDR('Body Composition')}
  <div class="content">
    <div><div class="section-title">What You're Made Of</div><div class="section-desc">DEXA breaks your total body mass into lean tissue, fat, and bone mineral.</div></div>
    <div class="card">
      <div class="card-title">Composition Breakdown</div>
      <div class="stack-bar"><div class="stack-seg" style="background:var(--brand);flex:${g.leanMassPercent};">Lean ${g.leanMassPercent}%</div><div class="stack-seg" style="background:#8bb8e8;flex:${g.fatMassPercent};"></div><div class="stack-seg" style="background:#c4d9f0;flex:${g.boneMineralPercent};"></div></div>
      <div style="display:flex;justify-content:space-between;margin-top:5px;"><span style="font-size:0.5rem;color:var(--dim);font-weight:600;">Lean ${g.leanMassPercent}%</span><span style="font-size:0.5rem;color:var(--dim);font-weight:600;">Fat ${g.fatMassPercent}%</span><span style="font-size:0.5rem;color:var(--dim);font-weight:600;">Bone ${g.boneMineralPercent}%</span></div>
    </div>
    <div style="display:flex;gap:10px;flex:1;max-height:520px;">
      <div style="width:155px;flex-shrink:0;position:relative;">
        <img src="${bc.image}" alt="DEXA Scan" style="width:100%;height:100%;border-radius:12px;object-fit:cover;">
        <div style="position:absolute;bottom:6px;left:50%;transform:translateX(-50%);display:flex;gap:6px;background:rgba(0,0,0,0.6);backdrop-filter:blur(4px);padding:3px 8px;border-radius:20px;">
          <div style="display:flex;align-items:center;gap:3px;"><span style="width:6px;height:6px;border-radius:2px;background:#00e5ff;"></span><span style="font-size:0.38rem;font-weight:600;color:white;">Lean</span></div>
          <div style="display:flex;align-items:center;gap:3px;"><span style="width:6px;height:6px;border-radius:2px;background:#ff4444;"></span><span style="font-size:0.38rem;font-weight:600;color:white;">Fat</span></div>
        </div>
      </div>
      <div style="flex:1;display:flex;flex-direction:column;gap:6px;">
        ${(()=>{const tips={'Lean Mass':'Resistance training and protein-rich diet help build and preserve lean tissue.','Fat Mass':'A sustained caloric deficit combined with strength training reduces fat while preserving muscle.','Bone Mineral':'Weight-bearing exercise, calcium, and vitamin D support bone mineral density.'};return [['Lean Mass',g.leanMassKg,bc.leanMass],['Fat Mass',g.fatMassKg,bc.fatMass],['Bone Mineral',g.boneMineralKg,bc.boneMineral]].map(([label,kg,item])=>{ const s = compScale(item); return `<div class="card" style="padding:12px 14px;flex:1;display:flex;flex-direction:column;">
          <div style="display:flex;justify-content:space-between;align-items:baseline;margin-bottom:4px;"><span style="font-size:0.68rem;font-weight:700;">${label}</span><span class="num-md">${kg} <small style="font-size:0.5rem;color:var(--mute);font-family:'DM Sans';font-weight:600;">kg</small></span></div>
          <div style="font-size:0.52rem;color:var(--dim);margin-bottom:6px;">${item.description}</div>
          ${s ? `<div class="range-bar" style="background:${s.grad};"><div class="range-dot" style="left:${s.pos}%;"></div></div>
          <div class="verdict" style="color:${vc(s.verdictColor)};margin-bottom:6px;"><span class="verdict-dot" style="background:${vd(s.verdictColor)};"></span> ${s.verdict}</div>`
          : `<div class="range-bar" style="background:#e5e7eb;"></div>
          <div class="verdict" style="color:var(--mute);margin-bottom:6px;"><span class="verdict-dot" style="background:var(--mute);"></span> Scale not available</div>`}
          <div style="margin-top:auto;font-size:0.48rem;color:var(--dim);line-height:1.5;border-top:1px solid var(--border);padding-top:6px;">${tips[label]}</div>
        </div>`; }).join('')})()}
      </div>
    </div>
    <div class="action ${ac(bc.insightColor)}"><strong>${bc.insight.split('.')[0]}.</strong> ${bc.insight.split('.').slice(1).join('.').trim()}</div>
  </div>
  ${FTR(3,tp)}
</div>

<!-- PAGE 4: COMPOSITION TRENDS -->
<div class="page">
  ${HDR('Composition Trends')}
  <div class="content" style="display:flex; flex-direction:column;">
    <div><div class="section-title">How Your Body Has Changed</div><div class="section-desc">Tracking lean mass, fat mass, and weight across ${ct.scans.length} DEXA scans since ${ct.scans[0].date}.</div></div>
    ${trendCard('Body Fat % Trend', ct.scans.map(s=>({date:s.date,value:s.bodyFatPercent})), 'Fat %', '%')}
    ${trendCard('Lean Mass Trend', ct.scans.map(s=>({date:s.date,value:s.leanMassKg})), 'Lean (kg)', '')}
    ${trendCard('Fat Mass Trend', ct.scans.map(s=>({date:s.date,value:s.fatMassKg})), 'Fat (kg)', '')}
  </div>
  ${FTR(4,tp)}
</div>

<!-- PAGE 5: REGIONAL ANALYSIS -->
<div class="page">
  ${HDR('Regional Analysis')}
  <div class="content">
    <div><div class="section-title">Where Your Fat Lives</div><div class="section-desc">DEXA measures composition in 5 distinct regions, revealing how lean tissue and fat are distributed across your body.</div></div>
    ${REGION_ORDER.map(key=>{ const r = ra[key], info = REGIONS[key]; if(!r) return ''; return `<div class="region">
      <div class="region-img"><img src="/images/regions/${info.image}.png" alt="${info.name}" style="width:100%; height:100%; object-fit:cover; border-radius:8px;" /></div>
      <div class="region-data">
        <div class="region-name">${info.name}</div>
        <div style="display:flex;align-items:baseline;gap:8px;">
          <div class="region-fat">${r.fatPercent}<small>% fat</small></div>
          <div class="region-delta" style="color:${r.change <= 0 ? 'var(--grn)' : 'var(--red)'};">${r.change <= 0 ? '&darr;' : '&uarr;'} ${Math.abs(r.change)}% from ${r.previousDate}</div>
        </div>
        <div class="region-metrics">
          <div class="region-met"><div class="region-met-label">Lean</div><div class="region-met-val">${r.leanKg} kg</div></div>
          <div class="region-met"><div class="region-met-label">Fat</div><div class="region-met-val">${r.fatKg} kg</div></div>
          <div class="region-met"><div class="region-met-label">Total</div><div class="region-met-val">${r.totalKg} kg</div></div>
        </div>
      </div>
    </div>`; }).join('')}
  </div>
  ${FTR(5,tp)}
</div>

<!-- PAGE 6: REGIONAL TRENDS -->
<div class="page">
  ${HDR('Regional Trends')}
  <div class="content">
    <div><div class="section-title">Regional Fat % Over Time</div><div class="section-desc">How fat percentage in each body region has changed across your ${rt.scanDates.length} scans.</div></div>
    <div class="card">
      <div class="card-title">All Regions &mdash; Fat % Trend</div>
      <div class="trend-chart">
        ${(()=>{
          const colors = ['var(--pri)','#555','#888','#aaa','#ccc'];
          const regions = Object.keys(rt.fatPercentByRegion);
          const allVals = regions.flatMap(r=>rt.fatPercentByRegion[r]);
          const mn=Math.min(...allVals), mx=Math.max(...allVals), rng=mx-mn||1;
          const W=400, H=170, pX=30, pY=5, cH=155, cW=340;
          const x=i=>pX+(i/(rt.scanDates.length-1))*cW;
          const y=v=>pY+(1-(v-mn)/rng)*cH;
          let svg='<svg viewBox="0 0 400 170" style="width:100%;height:130px;">';
          svg+='<line x1="0" y1="'+(H-10)+'" x2="400" y2="'+(H-10)+'" stroke="#e5e7eb" stroke-width="0.5"/>';
          svg+='<line x1="0" y1="'+Math.round(H/2)+'" x2="400" y2="'+Math.round(H/2)+'" stroke="#e5e7eb" stroke-width="0.5" stroke-dasharray="3"/>';
          svg+='<line x1="0" y1="5" x2="400" y2="5" stroke="#e5e7eb" stroke-width="0.5"/>';
          regions.forEach((r,ri)=>{
            const pts=rt.fatPercentByRegion[r].map((v,i)=>x(i).toFixed(0)+','+y(v).toFixed(0)).join(' ');
            const lastY=y(rt.fatPercentByRegion[r].slice(-1)[0]).toFixed(0);
            svg+='<polyline points="'+pts+'" fill="none" stroke="'+colors[ri]+'" stroke-width="2" stroke-linecap="round"/>';
            svg+='<text x="380" y="'+(Number(lastY)+3)+'" font-size="7" fill="'+colors[ri]+'" font-weight="'+(ri===0?700:600)+'">'+r+'</text>';
          });
          svg+='</svg>';
          return svg;
        })()}
        <div class="trend-labels">${rt.scanDates.map(d=>'<span>'+d+'</span>').join('')}</div>
      </div>
    </div>
    <div class="card" style="padding:12px 16px;">
      <div class="card-title" style="margin-bottom:5px;">Fat % by Region</div>
      <table class="dtable">
        <tr><th style="padding:5px 7px;font-size:0.48rem;">Region</th>${rt.scanDates.map(d=>'<th style="padding:5px 7px;font-size:0.48rem;">'+d+'</th>').join('')}</tr>
        ${Object.keys(rt.fatPercentByRegion).map(r=>'<tr><td style="padding:5px 7px;font-size:0.65rem;">'+r+'</td>'+rt.fatPercentByRegion[r].map((v,i,a)=>'<td style="padding:5px 7px;font-size:0.65rem;">'+(i===a.length-1?'<strong>':'')+v+'%'+(i===a.length-1?'</strong>':'')+'</td>').join('')+'</tr>').join('')}
      </table>
    </div>
    <div class="card" style="padding:12px 16px;">
      <div class="card-title" style="margin-bottom:5px;">Lean Mass by Region (kg)</div>
      <table class="dtable">
        <tr><th style="padding:5px 7px;font-size:0.48rem;">Region</th>${rt.scanDates.map(d=>'<th style="padding:5px 7px;font-size:0.48rem;">'+d+'</th>').join('')}</tr>
        ${Object.keys(rt.leanMassByRegion).map(r=>'<tr><td style="padding:5px 7px;font-size:0.65rem;">'+r+'</td>'+rt.leanMassByRegion[r].map((v,i,a)=>'<td style="padding:5px 7px;font-size:0.65rem;">'+(i===a.length-1?'<strong>':'')+v+(i===a.length-1?'</strong>':'')+'</td>').join('')+'</tr>').join('')}
      </table>
    </div>
  </div>
  ${FTR(6,tp)}
</div>

<!-- PAGE 7: LEFT VS RIGHT — Arms & Legs -->
<div class="page">
  ${HDR('Left vs Right')}
  <div class="content">
    <div><div class="section-title">Symmetry Check</div><div class="section-desc">Comparing the left and right sides of your body to detect muscle imbalances or asymmetric fat storage.</div></div>
    ${Object.entries(sym.regions).filter(([key])=>key!=='trunk').map(([key,r])=>{const name=key.charAt(0).toUpperCase()+key.slice(1);const t=r.thresholds;const v=r.val;const status=v<=t[1]?'Good balance':v<=t[2]?'Minor imbalance':'Significant imbalance';const statusColor=v<=t[1]?'green':v<=t[2]?'yellow':'red';const scalePos=Math.min(95,Math.max(5,v/t[3]*100));return`<div class="sym-region" style="flex-wrap:wrap;">
      <div class="sym-img"><img src="/images/regions/${key}.png" alt="${name}" style="width:100%; height:100%; object-fit:cover; border-radius:8px;" /></div>
      <div class="sym-data">
        <div style="display:flex; justify-content:space-between; align-items:baseline; margin-bottom:6px;"><div class="sym-name" style="margin-bottom:0;">${name}</div><span style="font-size:0.5rem; font-weight:700; color:${vc(statusColor)};">${status}</span></div>
        <table class="sym-table">
          <tr><th></th><th>Left</th><th>Right</th></tr>
          <tr><td>Fat %</td><td><strong>${r.left.fatPercent}%</strong></td><td><strong>${r.right.fatPercent}%</strong></td></tr>
          <tr><td>Total</td><td>${r.left.totalKg} kg</td><td>${r.right.totalKg} kg</td></tr>
          <tr><td>Lean</td><td>${r.left.leanKg} kg</td><td>${r.right.leanKg} kg</td></tr>
          <tr><td>Fat</td><td>${r.left.fatKg} kg</td><td>${r.right.fatKg} kg</td></tr>
          <tr><td>Bone</td><td>${r.left.boneKg} kg</td><td>${r.right.boneKg} kg</td></tr>
        </table>
      </div>
      <div style="width:100%; margin-top:10px;">
        <div class="range-bar" style="background:linear-gradient(90deg, #34d399 0%, #34d399 ${100*t[1]/t[3]}%, #fbbf24 ${100*t[2]/t[3]}%, #f87171 100%);"><div class="range-dot" style="left:${scalePos}%;"></div></div>
        <div style="display:flex; justify-content:space-between; font-size:0.7rem; color:var(--mute); margin-top:2px;"><span>Balanced</span><span>Imbalanced</span></div>
      </div>
      <div style="width:100%; font-size:0.8rem; color:var(--dim); line-height:1.5; margin-top:8px;">${r.description}</div>
    </div>`}).join('')}
  </div>
  ${FTR(7,tp)}
</div>

<!-- PAGE 8: LEFT VS RIGHT — Trunk + Insight -->
<div class="page">
  ${HDR('Left vs Right')}
  <div class="content">
    ${(()=>{const key='trunk';const r=sym.regions[key];const name='Trunk';const t=r.thresholds;const v=r.val;const status=v<=t[1]?'Good balance':v<=t[2]?'Minor imbalance':'Significant imbalance';const statusColor=v<=t[1]?'green':v<=t[2]?'yellow':'red';const scalePos=Math.min(95,Math.max(5,v/t[3]*100));return`<div class="sym-region" style="flex-wrap:wrap;">
      <div class="sym-img"><img src="/images/regions/${key}.png" alt="${name}" style="width:100%; height:100%; object-fit:cover; border-radius:8px;" /></div>
      <div class="sym-data">
        <div style="display:flex; justify-content:space-between; align-items:baseline; margin-bottom:6px;"><div class="sym-name" style="margin-bottom:0;">${name}</div><span style="font-size:0.5rem; font-weight:700; color:${vc(statusColor)};">${status}</span></div>
        <table class="sym-table">
          <tr><th></th><th>Left</th><th>Right</th></tr>
          <tr><td>Fat %</td><td><strong>${r.left.fatPercent}%</strong></td><td><strong>${r.right.fatPercent}%</strong></td></tr>
          <tr><td>Total</td><td>${r.left.totalKg} kg</td><td>${r.right.totalKg} kg</td></tr>
          <tr><td>Lean</td><td>${r.left.leanKg} kg</td><td>${r.right.leanKg} kg</td></tr>
          <tr><td>Fat</td><td>${r.left.fatKg} kg</td><td>${r.right.fatKg} kg</td></tr>
          <tr><td>Bone</td><td>${r.left.boneKg} kg</td><td>${r.right.boneKg} kg</td></tr>
        </table>
      </div>
      <div style="width:100%; margin-top:10px;">
        <div class="range-bar" style="background:linear-gradient(90deg, #34d399 0%, #34d399 ${100*t[1]/t[3]}%, #fbbf24 ${100*t[2]/t[3]}%, #f87171 100%);"><div class="range-dot" style="left:${scalePos}%;"></div></div>
        <div style="display:flex; justify-content:space-between; font-size:0.7rem; color:var(--mute); margin-top:2px;"><span>Balanced</span><span>Imbalanced</span></div>
      </div>
      <div style="width:100%; font-size:0.8rem; color:var(--dim); line-height:1.5; margin-top:8px;">${r.description}</div>
    </div>`})()}
    ${sym.insight?`<div class="action ${ac(sym.insightColor||'green')}"><strong>${sym.insight.split(':')[0]}:</strong> ${sym.insight.split(':').slice(1).join(':').trim()}</div>`:''}
    <div class="card" style="margin-top:10px;">
      <div class="card-title">What Causes Imbalances?</div>
      <div style="font-size:0.58rem; color:var(--dim); line-height:1.7;">
        <div style="margin-bottom:6px;"><strong style="color:var(--txt);">Hand dominance</strong> — Your dominant side naturally carries more muscle from daily use.</div>
        <div style="margin-bottom:6px;"><strong style="color:var(--txt);">One-sided sports</strong> — Tennis, cricket, or golf develop one side more than the other.</div>
        <div style="margin-bottom:6px;"><strong style="color:var(--txt);">Injury compensation</strong> — Favouring one side after an injury shifts load to the other.</div>
        <div><strong style="color:var(--txt);">Uneven training</strong> — Machine-based exercises can mask imbalances that free weights expose.</div>
      </div>
    </div>
    <div class="card" style="margin-top:10px;">
      <div class="card-title">How to Reduce Imbalances</div>
      <div style="font-size:0.58rem; color:var(--dim); line-height:1.7;">
        <div style="margin-bottom:8px; padding:8px 10px; background:rgba(248,113,113,0.08); border-left:3px solid #f87171; border-radius:4px; color:var(--txt); font-weight:600;">You cannot spot-reduce fat. Fat loss happens overall through a caloric deficit. But you <em>can</em> spot-build muscle by targeting specific regions with resistance training.</div>
        <div style="margin-bottom:6px;"><strong style="color:var(--txt);">Use unilateral exercises</strong> — Single-arm rows, lunges, and single-leg deadlifts force each side to work independently.</div>
        <div style="margin-bottom:6px;"><strong style="color:var(--txt);">Start with the weaker side</strong> — Begin each set with your weaker side and match the reps on the stronger side.</div>
        <div style="margin-bottom:6px;"><strong style="color:var(--txt);">Swap machines for free weights</strong> — Dumbbells and kettlebells prevent your dominant side from compensating.</div>
        <div><strong style="color:var(--txt);">Track with regular scans</strong> — A DEXA scan every 3–4 months shows whether the gap is closing over time.</div>
      </div>
    </div>
  </div>
  ${FTR(8,tp)}
</div>

<!-- PAGE 9: VISCERAL & SUBCUTANEOUS FAT -->
<div class="page">
  ${HDR('Fat Analysis')}
  <div class="content">
    <div><div class="section-title">Visceral &amp; Subcutaneous Fat</div><div class="section-desc">Visceral fat surrounds your organs and is linked to serious health risks. Subcutaneous fat sits under your skin.</div></div>
    ${vf?`<div class="g2">
      <div class="card" style="text-align:center;"><div class="label">Visceral Fat</div><div class="num-lg" style="margin:6px 0 3px;">${vf.massGrams}</div><div style="font-size:0.5rem; color:var(--mute);">grams</div><div class="tag ${tc(vf.val<=vf.thresholds[1]?'green':vf.val<=vf.thresholds[2]?'yellow':'red')}" style="margin-top:6px;">${vf.status}</div></div>
      <div class="card" style="text-align:center;"><div class="label">Subcutaneous Fat</div><div class="num-lg" style="margin:6px 0 3px;">${vf.subcutaneousKg}</div><div style="font-size:0.5rem; color:var(--mute);">grams</div><div class="tag tag-n" style="margin-top:6px;">${vf.subcutaneousPercent}% of total fat</div></div>
    </div>
    <div class="card">
      <div class="card-title">Visceral Fat Detail</div>
      <div class="g3" style="margin-bottom:10px;">
        <div style="text-align:center;"><div class="label" style="color:var(--mute);">Mass</div><div class="num-sm" style="margin-top:3px;">${vf.massGrams}<small style="font-size:0.5rem; color:var(--mute); font-family:'DM Sans';"> g</small></div></div>
        <div style="text-align:center;"><div class="label" style="color:var(--mute);">Volume</div><div class="num-sm" style="margin-top:3px;">${vf.volumeCm3}<small style="font-size:0.5rem; color:var(--mute); font-family:'DM Sans';"> cm&sup3;</small></div></div>
        <div style="text-align:center;"><div class="label" style="color:var(--mute);">Area</div><div class="num-sm" style="margin-top:3px;">${vf.areaCm2}<small style="font-size:0.5rem; color:var(--mute); font-family:'DM Sans';"> cm&sup2;</small></div></div>
      </div>
      ${(()=>{const t=vf.thresholds;const v=vf.val;const scalePos=Math.min(95,Math.max(5,v/t[3]*100));return`<div class="vf-scale" style="margin-top:25px; background:linear-gradient(90deg, #34d399 0%, #34d399 ${100*t[1]/t[3]}%, #fbbf24 ${100*t[2]/t[3]}%, #f87171 100%);"><div class="vf-you" style="left:${scalePos}%;">You</div><div class="vf-dot" style="left:${scalePos}%;"></div></div>
      <div style="display:flex; justify-content:space-between; font-size:0.48rem; color:var(--mute); font-weight:600;"><span>Safe</span><span>Moderate</span><span>High</span></div>`})()}
    </div>
    <div class="card">
      <div class="card-title">Visceral Fat Trend</div>
      <div class="trend-chart">
        ${trendSvg(vf.trend.map(t=>({date:t.date,value:t.grams})),400,70,'g')}
        ${trendLabels(vf.trend)}
      </div>
    </div>
    <div class="action ${ac(vf.insightColor)}"><strong>${vf.insight.split('.')[0]}.</strong> ${vf.insight.split('.').slice(1).join('.').trim()}</div>`
    :`<div class="g2">
      <div class="card" style="text-align:center; opacity:0.4;"><div class="label">Visceral Fat</div><div class="num-lg" style="margin:6px 0 3px;">N/A</div><div style="font-size:0.5rem; color:var(--mute);">grams</div><div class="tag tag-n" style="margin-top:6px;">Not available</div></div>
      <div class="card" style="text-align:center; opacity:0.4;"><div class="label">Subcutaneous Fat</div><div class="num-lg" style="margin:6px 0 3px;">N/A</div><div style="font-size:0.5rem; color:var(--mute);">grams</div><div class="tag tag-n" style="margin-top:6px;">Not available</div></div>
    </div>
    <div class="card" style="opacity:0.4;">
      <div class="card-title">Visceral Fat Detail</div>
      <div class="g3" style="margin-bottom:10px;">
        <div style="text-align:center;"><div class="label" style="color:var(--mute);">Mass</div><div class="num-sm" style="margin-top:3px;">N/A</div></div>
        <div style="text-align:center;"><div class="label" style="color:var(--mute);">Volume</div><div class="num-sm" style="margin-top:3px;">N/A</div></div>
        <div style="text-align:center;"><div class="label" style="color:var(--mute);">Area</div><div class="num-sm" style="margin-top:3px;">N/A</div></div>
      </div>
      <div class="vf-scale" style="margin-top:25px; background:#e5e7eb !important;"></div>
      <div style="display:flex; justify-content:space-between; font-size:0.48rem; color:var(--mute); font-weight:600;"><span>Safe</span><span>Moderate</span><span>High</span></div>
    </div>
    <div class="action ${ac('neutral')}"><strong>Visceral fat data is not available for this scan.</strong> DEXA visceral fat estimation is not calculated for individuals under 18 years of age or beyond a certain height-to-weight ratio. If you believe this is an error, please contact Body Insight for assistance.</div>`}
  </div>
  ${FTR(9,tp)}
</div>

<!-- PAGE 10: BONE HEALTH -->
<div class="page">
  ${HDR('Bone Health')}
  <div class="content">
    <div><div class="section-title">Your Skeleton</div><div class="section-desc">DEXA measures bone mineral density (BMD) &mdash; a key indicator of skeletal strength and fracture risk.</div></div>
    <div class="g2">
      <div class="card" style="text-align:center;${bh.tScore!=null?'':' opacity:0.4;'}"><div class="label">T-Score (Young Adult)</div><div class="num-lg" style="margin:6px 0 3px;">${bh.tScore!=null?bh.tScore:'N/A'}</div><div style="font-size:0.5rem; color:var(--dim);">${bh.tScore!=null?'vs healthy 30-yr-old':'Not available'}</div><div class="tag ${tc(bh.tScore!=null?(bh.tScore<-1?'red':bh.tScore<0?'yellow':'green'):'grey')}" style="margin-top:5px;">${bh.tScore!=null?bh.tScoreStatus:'Not available'}</div></div>
      <div class="card" style="text-align:center;${bh.zScore!=null?'':' opacity:0.4;'}"><div class="label">Z-Score (Age Matched)</div><div class="num-lg" style="margin:6px 0 3px;">${bh.zScore!=null?bh.zScore:'N/A'}</div><div style="font-size:0.5rem; color:var(--dim);">${bh.zScore!=null?'vs your age group':'Not available'}</div><div class="tag ${tc(bh.zScore!=null?(bh.zScore<-1?'red':bh.zScore<0?'yellow':'green'):'grey')}" style="margin-top:5px;">${bh.zScore!=null?bh.zScoreStatus:'Not available'}</div></div>
    </div>
    <div class="card">
      <div class="card-title">Bone Density Scale</div>
      ${(()=>{const t=bh.thresholds;const v=bh.val;if(v!=null&&t){const scalePos=Math.min(95,Math.max(5,(v-t[0])/(t[3]-t[0])*100));return`<div class="bh-scale-bar" style="background:linear-gradient(90deg, #f87171 0%, #fbbf24 ${100*(t[1]-t[0])/(t[3]-t[0])}%, #34d399 ${100*(t[2]-t[0])/(t[3]-t[0])}%, #34d399 100%);"><div class="vf-you" style="left:${scalePos}%;">You</div><div class="vf-dot" style="left:${scalePos}%;"></div></div>`}else{return`<div class="bh-scale-bar" style="background:#e5e7eb !important;"></div>`}})()}
      <div style="display:flex; justify-content:space-between; font-size:0.48rem; color:var(--mute); font-weight:600;"><span>Very Low</span><span>Average</span><span>Excellent</span></div>
      <div style="margin-top:8px; padding-top:8px; border-top:1px solid var(--border); font-size:0.5rem; line-height:1.5; color:var(--mute);"><strong>${bh.insight.split('.')[0]}.</strong> ${bh.insight.split('.').slice(1).join('.').trim()}</div>
    </div>
    ${trendCard('T-Score Trend', bh.trend.tScore, 'T-Score', '')}
    <div class="g2">
      <div class="insight"><h4>What the scores mean</h4><p><strong>T-Score</strong> compares to peak bone mass of a healthy young adult. <strong>Z-Score</strong> compares to your age group. Below -2.5 = osteoporosis.</p></div>
      <div class="insight"><h4>Strengthen your bones</h4><ul><li>Calcium &amp; Vitamin D</li><li>Weight-bearing exercise</li><li>Resistance training</li><li>Avoid smoking &amp; excess alcohol</li></ul></div>
    </div>
  </div>
  ${FTR(10,tp)}
</div>

<!-- PAGE 11: BONE TRENDS -->
<div class="page">
  ${HDR('Regional Bone Density')}
  <div class="content" style="display:flex; flex-direction:column;">
    <div><div class="section-title">Bone Health Over Time</div><div class="section-desc">Tracking your T-Score and total bone mineral density across ${bh.trend.tScore.length} DEXA scans.</div></div>
    <div class="card" style="flex:1; display:flex; flex-direction:column;">
      <div class="card-title">Bone Mineral Density by Region (g/cm&sup2;)</div>
      <div class="bone-grid" style="flex:1;">
        ${Object.entries(bh.bmdByRegion).map(([name,val],i,a)=>'<div class="bone-card"'+(i===a.length-1?' style="background:#f3f4f6;"':'')+'><div class="bone-img"><img src="/images/bone/'+name.toLowerCase()+'.png" alt="'+name+'" style="width:100%; height:100%; object-fit:cover; border-radius:6px;" /></div><div class="bone-name"'+(i===a.length-1?' style="color:var(--txt);"':'')+'>'+name+'</div><div class="bone-val">'+val+'</div></div>').join('')}
      </div>
    </div>
    ${trendCard('Total BMD Trend (g/cm&sup2;)', bh.trend.totalBmd, 'BMD', '')}
  </div>
  ${FTR(11,tp)}
</div>

<!-- PAGE 12: A/G RATIO -->
<div class="page">
  ${HDR('Fat Distribution')}
  <div class="content">
    <div><div class="section-title">Android-to-Gynoid Ratio</div><div class="section-desc">This ratio compares fat in your belly (android) to your hips (gynoid). It reveals whether you carry weight in a pattern associated with higher or lower metabolic risk.</div></div>
    ${(()=>{const t=ag.thresholds;const v=ag.value;const c=v<t[1]?'green':v<t[2]?'yellow':'red';const scalePos=Math.min(95,Math.max(5,(v-t[0])/(t[3]-t[0])*100));return`<div class="card" style="text-align:center; padding:24px;">
      <div class="label">Your A/G Ratio</div>
      <div class="num-hero" style="margin:8px 0 10px;">${v}</div>
      <div style="position:relative; margin:0 auto; max-width:340px;">
        <div class="range-bar" style="background:linear-gradient(90deg, #34d399 0%, #34d399 ${100*(t[1]-t[0])/(t[3]-t[0])}%, #fbbf24 ${100*(t[2]-t[0])/(t[3]-t[0])}%, #f87171 100%); height:6px;"><div class="range-dot" style="left:${scalePos}%;"></div></div>
        <div style="display:flex; justify-content:space-between; font-size:0.42rem; color:var(--mute); font-weight:600; margin-top:4px;"><span>${t[0]}</span><span>${t[1]}</span><span>${t[2]}</span><span>${t[3]}</span></div>
      </div>
      <div class="verdict" style="color:${vc(c)}; margin-top:8px;"><span class="verdict-dot" style="background:${vd(c)};"></span> ${ag.verdict}</div>
    </div>`})()}
    <div class="g2">
      <div class="insight"><h4>What is A/G Ratio?</h4><p>Compares fat percentage in your belly vs hip region using DEXA fat %, not waist inches &mdash; far more accurate than a tape measure.</p></div>
      <div class="insight"><h4>Why it matters</h4><p>Ratios above 1.0 correlate with higher visceral fat and metabolic risk. Below 1.0 is associated with lower cardiovascular risk.</p></div>
    </div>
    <div class="action ${ac(ag.value<ag.thresholds[1]?'green':ag.value<ag.thresholds[2]?'yellow':'red')}"><strong>${ag.insight.split('.')[0]}.</strong> ${ag.insight.split('.').slice(1).join('.').trim()}</div>
    ${trendCard('A/G Ratio Trend', ag.trend, 'A/G Ratio', '')}
  </div>
  ${FTR(12,tp)}
</div>

<!-- PAGE 13: SARCOPENIA SCREENING -->
<div class="page">
  ${HDR('Muscle Health')}
  <div class="content">
    <div><div class="section-title">Sarcopenia Screening</div><div class="section-desc">ALMI (Appendicular Lean Mass Index) measures the lean mass in your arms and legs relative to your height &mdash; the clinical standard for detecting muscle loss.</div></div>
    ${(()=>{const t=sa.thresholds;const v=sa.value;const c=v<t[1]?'red':v<t[2]?'yellow':'green';const scalePos=Math.min(95,Math.max(5,(v-t[0])/(t[3]-t[0])*100));return`<div class="card" style="text-align:center; padding:20px;">
      <div class="label">Your ALMI</div>
      <div class="num-hero" style="margin:6px 0 3px;">${v}</div>
      <div style="font-size:0.6rem; color:var(--dim);">kg/m&sup2;</div>
      <div style="position:relative; margin:12px auto 0; max-width:340px;">
        <div class="range-bar" style="background:linear-gradient(90deg, #f87171 0%, #fbbf24 ${100*(t[1]-t[0])/(t[3]-t[0])}%, #34d399 ${100*(t[2]-t[0])/(t[3]-t[0])}%, #34d399 100%); height:6px;"><div class="range-dot" style="left:${scalePos}%;"></div></div>
        <div style="display:flex; justify-content:space-between; font-size:0.42rem; color:var(--mute); font-weight:600; margin-top:4px;"><span>${t[0]}</span><span>${t[1]}</span><span>${t[2]}</span><span>${t[3]}</span></div>
      </div>
      <div class="verdict" style="color:${vc(c)}; margin-top:8px;"><span class="verdict-dot" style="background:${vd(c)};"></span> ${sa.verdict}</div>
    </div>`})()}
    <div class="g2">
      <div class="insight"><h4>Why it matters</h4><p>Low ALMI signals age-related muscle loss (sarcopenia), increasing fall risk, frailty, and metabolic dysfunction. Resistance training is the best prevention.</p></div>
      <div class="insight"><h4>How to improve ALMI</h4><ul><li>Progressive resistance training</li><li>High-protein diet</li><li>Adequate sleep &amp; recovery</li><li>Creatine supplementation</li></ul></div>
    </div>
    <div class="action ${ac(sa.value<sa.thresholds[1]?'red':sa.value<sa.thresholds[2]?'yellow':'green')}"><strong>${sa.insight.split('.')[0]}.</strong> ${sa.insight.split('.').slice(1).join('.').trim()}</div>
    ${trendCard('ALMI Trend', sa.trend, 'ALMI', '')}
  </div>
  ${FTR(13,tp)}
</div>

<!-- PAGE 14: METABOLISM -->
<div class="page">
  ${HDR('Metabolism')}
  <div class="content">
    <div><div class="section-title">How You Burn Energy</div><div class="section-desc">Your Resting Metabolic Rate (RMR) is how many calories your body burns at complete rest.</div></div>
    ${(()=>{const t=met.thresholds;const v=met.rmr;const c=v<t[1]?'red':v<t[2]?'yellow':'green';const scalePos=Math.min(95,Math.max(5,(v-t[0])/(t[3]-t[0])*100));return`<div class="card" style="text-align:center; padding:22px;">
      <div class="label">Resting Metabolic Rate</div>
      <div class="num-hero" style="margin:6px 0 3px;">${met.rmr}</div>
      <div style="font-size:0.65rem; color:var(--dim);">kcal per day at rest</div>
      <div style="position:relative; margin:12px auto 0; max-width:340px;">
        <div class="range-bar" style="background:linear-gradient(90deg, #f87171 0%, #fbbf24 ${100*(t[1]-t[0])/(t[3]-t[0])}%, #34d399 ${100*(t[2]-t[0])/(t[3]-t[0])}%, #34d399 100%); height:6px;"><div class="range-dot" style="left:${scalePos}%;"></div></div>
        <div style="display:flex; justify-content:space-between; font-size:0.42rem; color:var(--mute); font-weight:600; margin-top:4px;"><span>${t[0]}</span><span>${t[1]}</span><span>${t[2]}</span><span>${t[3]}</span></div>
      </div>
      <div class="verdict" style="color:${vc(c)}; margin-top:8px;">${met.verdict}</div>
    </div>`})()}
    <div class="card" style="padding:12px 14px;flex:1;display:flex;flex-direction:column;">
      <div class="card-title">RMR Trend</div>
      <div class="trend-chart" style="flex:1;min-width:0;display:flex;flex-direction:column;">
        ${trendSvg(met.rmrTrend,400,70,'')}${trendLabels(met.rmrTrend)}
      </div>
    </div>
    <div class="g2">
      <div class="insight"><h4>What's a good RMR?</h4><p>There is no "good" RMR &mdash; it's unique to your body. However, higher RMR relative to your size means you burn more calories at rest.</p></div>
      <div class="insight"><h4>Can I increase RMR?</h4><p>Building muscle is the most effective way. Also: move often, eat whole foods frequently, try interval training, and get adequate sleep.</p></div>
    </div>
    <div class="card">
      <div class="card-title">Factors That Contribute to RMR</div>
      <div style="display:flex; flex-direction:column; gap:8px;">
        <div style="display:flex; gap:10px; align-items:flex-start;"><div style="font-size:0.85rem;">\u{1F3CB}\u{FE0F}</div><div><div style="font-size:0.62rem; font-weight:700; color:var(--txt);">Body Composition</div><div style="font-size:0.5rem; color:var(--dim);">Muscle burns more calories than fat. More lean mass = higher RMR.</div></div></div>
        <div style="display:flex; gap:10px; align-items:flex-start;"><div style="font-size:0.85rem;">\u{1F4CF}</div><div><div style="font-size:0.62rem; font-weight:700; color:var(--txt);">Body Size</div><div style="font-size:0.5rem; color:var(--dim);">Larger bodies require more energy to maintain basic functions.</div></div></div>
        <div style="display:flex; gap:10px; align-items:flex-start;"><div style="font-size:0.85rem;">\u{231B}</div><div><div style="font-size:0.62rem; font-weight:700; color:var(--txt);">Age</div><div style="font-size:0.5rem; color:var(--dim);">Metabolic slowdown and muscle loss occur naturally with age.</div></div></div>
        <div style="display:flex; gap:10px; align-items:flex-start;"><div style="font-size:0.85rem;">\u{1F464}</div><div><div style="font-size:0.62rem; font-weight:700; color:var(--txt);">Gender</div><div style="font-size:0.5rem; color:var(--dim);">Men tend to have higher RMR due to greater muscle mass.</div></div></div>
        <div style="display:flex; gap:10px; align-items:flex-start;"><div style="font-size:0.85rem;">\u{1F321}\u{FE0F}</div><div><div style="font-size:0.62rem; font-weight:700; color:var(--txt);">Environment</div><div style="font-size:0.5rem; color:var(--dim);">Extreme heat or cold forces the body to work harder to regulate temperature.</div></div></div>
      </div>
    </div>
  </div>
  ${FTR(14,tp)}
</div>

<!-- PAGE 15: RMR DEEP DIVE -->
<div class="page">
  ${HDR('Metabolism')}
  <div class="content">
    <div><div class="section-title">How to Use Your RMR</div><div class="section-desc">Use your RMR to estimate your total daily calorie burn based on activity level, then build your diet around that number.</div></div>
    <div class="card" style="text-align:center; padding:20px;">
      <div class="label">Your Total Daily Expenditure</div>
      <div class="num-hero" style="margin:6px 0 4px;">${Math.round(met.tdee)}</div>
      <div style="font-size:0.6rem; color:var(--dim);">kcal / day</div>
      <div style="margin-top:10px; padding-top:10px; border-top:1px solid var(--border); font-size:0.55rem; line-height:1.5; color:var(--dim);">This is the total number of calories your body burns each day, including rest, daily activity, and exercise. Eat around this to maintain weight, below to lose, or above to gain.</div>
    </div>
    <div class="card">
      <div class="card-title">How is TDEE Calculated?</div>
      <div style="display:flex; justify-content:center; gap:16px; padding:8px 0;">
        <div style="text-align:center;"><div class="num-sm" style="color:var(--txt);">${met.rmr}</div><div style="font-size:0.48rem; color:var(--dim);">RMR</div></div>
        <div style="font-size:0.7rem; color:var(--dim); align-self:center;">+</div>
        <div style="text-align:center;"><div class="num-sm" style="color:var(--txt);">${Math.round(met.lifestyleCalories)}</div><div style="font-size:0.48rem; color:var(--dim);">Lifestyle</div></div>
        <div style="font-size:0.7rem; color:var(--dim); align-self:center;">+</div>
        <div style="text-align:center;"><div class="num-sm" style="color:var(--txt);">${met.workoutCalories}</div><div style="font-size:0.48rem; color:var(--dim);">Workouts</div></div>
        <div style="font-size:0.7rem; color:var(--dim); align-self:center;">=</div>
        <div style="text-align:center;"><div class="num-sm" style="color:var(--pri); font-weight:800;">${Math.round(met.tdee)}</div><div style="font-size:0.48rem; color:var(--dim);">TDEE</div></div>
      </div>
      <div style="margin-top:8px; padding-top:8px; border-top:1px solid var(--border); font-size:0.55rem; line-height:1.5; color:var(--dim);"><strong style="color:var(--txt);">RMR</strong> is measured by your DEXA scan. <strong style="color:var(--txt);">Lifestyle</strong> accounts for daily non-exercise activity (walking, chores, work). <strong style="color:var(--txt);">Workouts</strong> covers intentional exercise sessions.</div>
      <div style="margin-top:6px; font-size:0.5rem; color:var(--dim); font-style:italic;">This assumes a sedentary lifestyle with a workout of 30 min weight training and 30 min jogging. Adjust using the tables below.</div>
      <div style="margin-top:4px; font-size:0.5rem; color:var(--dim); font-style:italic;">Tip: Your smartwatch's "active calories" already includes both lifestyle and workout burn — you can use that directly in place of those two values.</div>
    </div>
    <div class="g2">
      <div class="card">
        <div class="card-title">Lifestyle Activity Factor</div>
        <div style="font-size:0.48rem; color:var(--dim); margin-top:-7px; margin-bottom:6px;">Use these values to calculate your TDEE</div>
        <div style="display:flex; flex-direction:column;">
          <div style="display:flex; justify-content:space-between; align-items:center; padding:5px 0; border-bottom:1px solid #f3f4f6;"><span><span style="font-size:0.55rem; color:var(--txt); font-weight:600;">Sedentary</span><br><span style="font-size:0.48rem; color:var(--dim);">Desk job, minimal movement</span></span><span class="num-sm">${met.lifeStyleCaloriesMap.sedentary}</span></div>
          <div style="display:flex; justify-content:space-between; align-items:center; padding:5px 0; border-bottom:1px solid #f3f4f6;"><span><span style="font-size:0.55rem; color:var(--txt); font-weight:600;">Light activity</span><br><span style="font-size:0.48rem; color:var(--dim);">Walking, light chores</span></span><span class="num-sm">${met.lifeStyleCaloriesMap.light}</span></div>
          <div style="display:flex; justify-content:space-between; align-items:center; padding:5px 0; border-bottom:1px solid #f3f4f6;"><span><span style="font-size:0.55rem; color:var(--txt); font-weight:600;">Moderately active</span><br><span style="font-size:0.48rem; color:var(--dim);">Regular exercise, active job</span></span><span class="num-sm">${met.lifeStyleCaloriesMap.moderate}</span></div>
          <div style="display:flex; justify-content:space-between; align-items:center; padding:5px 0;"><span><span style="font-size:0.55rem; color:var(--txt); font-weight:600;">Very active</span><br><span style="font-size:0.48rem; color:var(--dim);">Intense daily training</span></span><span class="num-sm">${met.lifeStyleCaloriesMap.intense}</span></div>
        </div>
      </div>
      <div class="card">
        <div class="card-title">Calories Burned / 30 min</div>
        <div style="font-size:0.48rem; color:var(--dim); margin-top:-7px; margin-bottom:6px;">Use these values to calculate your TDEE</div>
        <div style="display:flex; flex-direction:column;">
          ${(()=>{const cb=met.caloriesBurnedPerHalfHour;const activities=[['WALKING','\u{1F6B6}','Walking'],['RUNNING_SLOW','\u{1F3C3}','Jogging'],['RUNNING_FAST','\u{1F3C3}\u{200D}\u{2642}\u{FE0F}','Running'],['CYCLING','\u{1F6B4}','Cycling'],['SWIMMING','\u{1F3CA}','Swimming'],['WEIGHT','\u{1F3CB}\u{FE0F}','Weight Training'],['YOGA','\u{1F9D8}','Yoga'],['BADMINTON','\u{1F3F8}','Badminton'],['BOXING','\u{1F94A}','Boxing']];return activities.filter(a=>cb[a[0]]!=null).map((a,i,arr)=>'<div style="display:flex; justify-content:space-between; padding:5px 0;'+(i<arr.length-1?' border-bottom:1px solid #f3f4f6;':'')+'"><span style="font-size:0.55rem; color:var(--dim);">'+a[1]+' '+a[2]+'</span><span class="num-sm">'+cb[a[0]]+'</span></div>').join('')})()}
        </div>
      </div>
    </div>
  </div>
  ${FTR(15,tp)}
</div>

<!-- PAGE 16: NUTRITION -->
<div class="page">
  ${HDR('Nutrition Plan')}
  <div class="content">
    <div><div class="section-title">Your Nutrition Plan</div><div class="section-desc">Personalized calorie and macro targets for three different goals based on your body composition.</div></div>
    <div style="display:flex; flex-direction:column; gap:8px;">
    ${nut.plans.map(p=>{const rec=p.recommended;const pred=Math.round(p.calories)<nut.tdee?'Should result in ~'+((nut.tdee-Math.round(p.calories))*7/7700).toFixed(1)+' kg loss per week':Math.round(p.calories)>nut.tdee?'Should result in ~'+((Math.round(p.calories)-nut.tdee)*7/7700).toFixed(1)+' kg gain per week':'Should help you maintain your current weight';return'<div class="macro-row"><div><div style="font-size:0.65rem; font-weight:700; color:var(--txt);">'+p.goal+(rec?' <span style="font-size:0.45rem; font-weight:700; color:var(--brand); background:rgba(0,122,255,0.1); padding:2px 8px; border-radius:10px; margin-left:6px; vertical-align:middle;">RECOMMENDED</span>':'')+'</div><div style="margin:4px 0 2px;"><span class="num-lg">'+Math.round(p.calories)+'</span> <span style="font-size:0.55rem; color:var(--dim);">kcal / day</span></div><div style="font-size:0.48rem; color:var(--dim);">'+pred+'</div></div><div class="macro-circles"><div class="macro-circ"><div class="macro-ring" style="border-color:var(--macro-p);"><span class="macro-ring-num">'+p.proteinG+'</span><span class="macro-ring-unit">grams</span></div><span class="macro-label">Protein</span></div><div class="macro-circ"><div class="macro-ring" style="border-color:var(--macro-c);"><span class="macro-ring-num">'+p.carbsG+'</span><span class="macro-ring-unit">grams</span></div><span class="macro-label">Carbs</span></div><div class="macro-circ"><div class="macro-ring" style="border-color:var(--macro-f);"><span class="macro-ring-num">'+p.fatG+'</span><span class="macro-ring-unit">grams</span></div><span class="macro-label">Fat</span></div></div></div>'}).join('')}
    </div>
    <div class="action ${ac('green')}"><strong>${nut.insight.split('.')[0]}.</strong> ${nut.insight.split('.').slice(1).join('.').trim()}</div>
    <div class="card" style="font-size:0.65rem; color:var(--dim); line-height:1.7;">
      <div class="card-title">How Nutrition Affects Your Body</div>
      <p style="margin-bottom:6px;"><strong style="color:var(--txt);">Calories determine your weight.</strong> Eat less than your TDEE and you lose weight. Eat more and you gain. But the number on the scale doesn't tell you what you're actually losing or gaining.</p>
      <p style="margin-bottom:6px;"><strong style="color:var(--txt);">Macros determine your composition.</strong> Two people on the same calorie deficit can get very different results. One loses mostly fat and keeps muscle. The other loses muscle, slows their metabolism, and ends up weaker &mdash; even at a lower weight. The difference is protein.</p>
      <p><strong style="color:var(--txt);">Protein is the key.</strong> It signals your body to preserve lean tissue during a deficit and build it during a surplus. Carbs fuel your workouts and daily energy. Fat supports hormones and cell health. Getting the ratio right makes every calorie count.</p>
    </div>
  </div>
  ${FTR(16,tp)}
</div>

<!-- PAGE 17: ACTION PLAN -->
<div class="page">
  ${HDR('Action Plan')}
  <div class="content">
    <div><div class="section-title">What to Do Next</div><div class="section-desc">Based on your full DEXA analysis, here are your priority actions ranked by importance.</div></div>
    <div class="card">
      ${ap.actions.map(a=>'<div class="ap-item"><div class="ap-num">'+a.priority+'</div><div class="ap-text"><h4>'+a.title+'</h4><p>'+a.description+'</p></div></div>').join('')}
    </div>
    <div style="background:var(--brand-light); border-radius:14px; padding:18px; text-align:center; border:1px solid rgba(0,122,255,0.12);">
      <div style="font-size:0.82rem; font-weight:700; color:var(--brand); margin-bottom:4px;">Questions about your report?</div>
      <div style="font-size:0.62rem; color:var(--dim); line-height:1.6;">Reach out at <strong>support@bodyinsight.in</strong> or visit <strong style="color:var(--brand);">bodyinsight.in</strong> to schedule your next scan.</div>
    </div>
    <div style="font-size:0.48rem; color:var(--mute); line-height:1.6; font-style:italic;">This report is generated from DEXA (Dual-Energy X-ray Absorptiometry) scan data and is intended for informational purposes. It does not constitute medical advice. Consult a healthcare professional before making changes to your diet or exercise program.</div>
  </div>
  ${FTR(17,tp)}
</div>
  `; // end of template literal
} // end of render()

// ── Init ────────────────────────────────────────────────────────────────────────
fetchReportData().then(render);
</script>
</body>
</html>
